<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>å°ˆæ¡ˆ:è£½ä½œDISCORDçš„PTTçˆ¬æ–‡æ©Ÿå™¨äºº</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="blog-post">
      <section id="header">
        <h3><a style="color: rgb(0, 69, 134);" target="_blank">è¬æ–‡æ· | Hsieh Wen Chieh</a></h3>
      </section>
    <div class="flex-section">
      <section id="about">
        <h1>å°ˆæ¡ˆ:è£½ä½œDISCORDçš„PTTçˆ¬æ–‡æ©Ÿå™¨äºº</h1>
        <h3>å°ˆæ¡ˆç°¡ä»‹</h3>
        <p>é€™æ˜¯ä¸€å€‹ç”¨ Python è£½ä½œçš„ Discord æ©Ÿå™¨äººï¼Œèƒ½å¤ è‡ªå‹•å¾ PTT çš„ PC_Shopping æ¿æŠ“å–æœ€æ–°æ–‡ç« ï¼Œä¸¦å³æ™‚æ¨æ’­åˆ°æŒ‡å®šçš„ Discord é »é“ä¸­ã€‚æ•´å€‹å°ˆæ¡ˆéƒ¨ç½²åœ¨è‡ªæ¶çš„ Linux VM ä¸Šï¼Œä¸¦æ”¯æ´é–‹æ©Ÿè‡ªå•Ÿå‹•ï¼Œæ–¹ä¾¿ç©©å®šé‹è¡Œã€‚</p>
        <h3>ç›®å‰ä½ˆç½²ç¾¤çµ„</h3>
        <p>PTTé›»è¦ç‰ˆçˆ¬æ–‡ Bot å·²æˆåŠŸéƒ¨ç½²è‡³å¤§å‹ Discord ç¤¾ç¾¤ï¼š<a href=" https://discord.gg/nk5PfzJetz " style="color: rgb(153, 45, 255);" target="_blank">ç±³å¥‡ä¸å¦™å±‹</a>ï¼ˆè¶…é 7,000 ä½æˆå“¡çš„å¤§å‹é›»è…¦é›¶çµ„ä»¶äº¤æµç¤¾ç¾¤ï¼‰</p>
        <h3>åŠŸèƒ½èªªæ˜</h3>
        <p>â€¢ å®šæ™‚çˆ¬å– PTT çœ‹æ¿é è¨­ (PC_Shopping)</p>
        <p>â€¢ å³æ™‚æ¨æ’­æ–°æ–‡ç« é€£çµåˆ° Discord é »é“</p>
        <p>â€¢ è‡ªå‹•é‡å•Ÿèˆ‡é–‹æ©Ÿè‡ªå•Ÿå‹•è¨­å®š</p>
        <h3>æŠ€è¡“ç´°ç¯€</h3>
        <p>â€¢ ä½¿ç”¨ requests + BeautifulSoup çˆ¬å– PTT æ–‡ç« </p>
        <p>â€¢ Discord Bot æ¶è¨­æ–¼ discord.py å¥—ä»¶ï¼ˆæ”¯æ´ command èˆ‡è¨Šæ¯è§¸ç™¼ï¼‰</p>
        <p>â€¢ æ­é… APScheduler å¯¦ç¾æ¯åˆ†é˜è‡ªå‹•ä»»å‹™æ’ç¨‹</p>
        <p>â€¢ ä½¿ç”¨ .env ç®¡ç† Discord Token èˆ‡ç™¼æ–‡é »é“ID</p>
        <p>â€¢ æœ€çµ‚éƒ¨ç½²åœ¨ç§äººä¼ºæœå™¨çš„ Debian è™›æ“¬æ©Ÿä¸Š</p>
        <h3>å¯¦éš›é‹ä½œç•«é¢</h3>
        <img src="images/dc-ptt-run.jpg" alt="æˆ‘çš„ç…§ç‰‡" width="600" />
        <p>"æœ‰æ–°æ–‡ç« æ™‚ï¼ŒDiscord é »é“è‡ªå‹•é¡¯ç¤ºæ–‡ç« æ¨™é¡Œèˆ‡é€£çµ(è—è‰²å­—é«”ç‚ºé€£çµ)"</p>
        <h3>åŸå§‹ç¢¼èˆ‡éƒ¨ç½²æ•™å­¸</h3>
        <a href="https://github.com/Xie-qwp1234/Discord-PTT-Web-Crawler" >Github</a>
        <h5>bot.py</h5>
        <pre><code class="language-python">
          import discord
          from discord.ext import commands
          import requests
          from bs4 import BeautifulSoup
          import json
          import asyncio

          # è®€å–è¨­å®šæª”
          with open("config.json", "r") as f:
              config = json.load(f)

          TOKEN = config["token"]
          CHANNEL_ID = int(config["channel_id"])
          PTT_URL = "https://www.ptt.cc/bbs/PC_Shopping/index.html"
          seen_links = set()

          # è¨­å®š Intents
          intents = discord.Intents.default()
          intents.guilds = True
          intents.messages = True

          bot = commands.Bot(command_prefix="!", intents=intents)

          # æŠ“å– PTT é›»è¦æ–‡ç« 
          def fetch_articles():
              headers = {"cookie": "over18=1"}
              res = requests.get(PTT_URL, headers=headers)
              soup = BeautifulSoup(res.text, "html.parser")
              entries = soup.select("div.r-ent")
              new_articles = []

              for entry in entries:
                  a_tag = entry.select_one("div.title a")
                  if not a_tag:
                      continue

                  title = a_tag.text.strip()
                  href = "https://www.ptt.cc" + a_tag["href"]
                  push = entry.select_one("div.nrec").text.strip()
                  author = entry.select_one("div.meta .author").text.strip()

                  if href not in seen_links:
                      seen_links.add(href)
                      new_articles.append({
                          "title": title,
                          "href": href,
                          "author": author,
                          "push": push or "0"
                      })

              return new_articles[::-1]

          @bot.event
          async def on_ready():
              print(f"âœ… æˆåŠŸç™»å…¥ Discord Botï¼š{bot.user}")
              try:
                  channel = await bot.fetch_channel(CHANNEL_ID)
                  await channel.send("ğŸ¤– æ©Ÿå™¨äººå·²å•Ÿå‹•ï¼Œé–‹å§‹ç›£æ§ PTT é›»è¦ç‰ˆã€‚")
              except Exception as e:
                  print(f"[éŒ¯èª¤] ç™¼é€å•Ÿå‹•è¨Šæ¯å¤±æ•—ï¼š{e}")
                  return

              while True:
                  try:
                      print("ğŸ” æ­£åœ¨æŠ“å– PTT é›»è¦æ–‡ç« ...")
                      articles = fetch_articles()
                      print(f"ğŸ“¥ æŠ“åˆ° {len(articles)} ç¯‡æ–°æ–‡ç« ")
                      for article in articles:
                          embed = discord.Embed(title=article["title"], url=article["href"], color=0x00ff00)
                          embed.add_field(name="ä½œè€…", value=article["author"], inline=True)
                          embed.add_field(name="æ¨æ–‡æ•¸", value=article["push"], inline=True)
                          await channel.send(embed=embed)
                  except Exception as e:
                      print(f"[éŒ¯èª¤] æ¨æ–‡å¤±æ•—ï¼š{e}")

                  await asyncio.sleep(300)  # æ¯ 5 åˆ†é˜æƒä¸€æ¬¡

          bot.run(TOKEN)

        </code></pre>

        <h5>dcpttbot.service</h5>
        <pre><code class="language-python">
          [Unit]
          Description=Discord Bot - dcpttbot
          After=network.target

          [Service]
          Type=simple
          WorkingDirectory=/home/dcptt
          ExecStart=/home/dcptt/venv/bin/python /home/dcptt/bot.py
          Restart=always
          RestartSec=5
          User=root

          [Install]
          WantedBy=multi-user.target

        </code></pre>

        <h5>config.json</h5>
        <pre><code class="language-python">
          {
            "token": "(ä½ çš„æ©Ÿå™¨äººTOKEN)",
            "channel_id": "(æƒ³ç™¼æ–‡çš„é »é“ID)"
          }
        </code></pre>
        <h3>å¿ƒå¾—</h3>
        <p>é€™æ¬¡æ¶è¨­ Discord PTT çˆ¬æ–‡æ©Ÿå™¨äººï¼Œå¾ç¨‹ç’°å¢ƒå»ºç½®åˆ°è‡ªå‹•åŒ–éƒ¨ç½²ï¼Œé›–ç„¶éç¨‹ä¸­é‡åˆ°ä¸€äº›å¥—ä»¶å®‰è£ã€æ¬Šé™éŒ¯èª¤æˆ–æ˜¯ç³»çµ±é‡é–‹å¾Œå¤±æ•ˆç­‰å•é¡Œï¼Œä½†ä¸€æ­¥æ­¥æ’æŸ¥å¾Œï¼Œä¹Ÿè®“æˆ‘æ›´ç†Ÿæ‚‰äº† Linux ç³»çµ±æ“ä½œèˆ‡ Discord Bot çš„æ•´é«”æµç¨‹ã€‚
        æœªä¾†æˆ‘ä¹Ÿæ‰“ç®—æŒçºŒå„ªåŒ–é€™å€‹ Botï¼Œæ¯”å¦‚åŠ å…¥æ¨æ’­æ¢ä»¶ç¯©é¸ã€è‡ªå‹•é‡å•Ÿåµæ¸¬ï¼Œç”šè‡³çµåˆç¶²é ä»‹é¢åšæˆä¸€å€‹ç°¡å–®çš„å¾Œå°ã€‚
        å¦‚æœä½ ä¹Ÿæœ‰æƒ³æ¶è¨­è‡ªå·±çš„çˆ¬æ–‡é€šçŸ¥æ©Ÿå™¨äººï¼Œé€™ç¯‡æ–‡ç« å¸Œæœ›èƒ½å°ä½ æœ‰å¹«åŠ©ï¼</p>
      </div>
    </section>

  

    <p><a href="index.html">â† è¿”å›é¦–é </a></p>
  </main>

  <footer>
    <p>ğ– ¿ä¸å…¬é–‹ &emsp; â˜(+886)ä¸å…¬é–‹ &emsp; ğŸ–‚109st955160@gmail.com</p>
    <p>&copy; 2025 æ–‡æ·</p>
  </footer>
</body>
</html>
